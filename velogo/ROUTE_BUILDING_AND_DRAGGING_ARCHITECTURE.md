# –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–±—É–¥–æ–≤–∏ —Ç–∞ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤

## üìã –ó–º—ñ—Å—Ç

1. [–ó–∞–≥–∞–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞](#–∑–∞–≥–∞–ª—å–Ω–∞-–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞)
2. [–ü–æ–±—É–¥–æ–≤–∞ –º–∞—Ä—à—Ä—É—Ç—ñ–≤](#–ø–æ–±—É–¥–æ–≤–∞-–º–∞—Ä—à—Ä—É—Ç—ñ–≤)
3. [–ü–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤](#–ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è-–º–∞—Ä—à—Ä—É—Ç—ñ–≤)
4. [–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤](#–¥–µ—Ç–∞–ª—å–Ω–∏–π-–æ–ø–∏—Å-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤)
5. [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–∏—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–∏—Ö)

---

## üèóÔ∏è –ó–∞–≥–∞–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–∏–Ω—Ü–∏–ø–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

–ü—Ä–æ—î–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **Clean Architecture** –∑ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è–º –Ω–∞ —à–∞—Ä–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              PRESENTATION LAYER                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  CreateRouteScreen (UI + State Management)       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –û–±—Ä–æ–±–∫–∞ –ø–æ–¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º –º–∞—Ä—à—Ä—É—Ç—É                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              DOMAIN LAYER                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Use Cases                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - CalculateRouteUseCase                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - CalculateRouteDistanceUseCase                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - CalculateElevationGainUseCase                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - CalculateWindEffectUseCase                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Entities                                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - RouteEntity                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - RouteSectionEntity                             ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              DATA LAYER                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Repositories                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - RoutingRepositoryImpl                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Core Services                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - RoadRoutingService                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - RouteDragService                               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üõ£Ô∏è –ü–æ–±—É–¥–æ–≤–∞ –º–∞—Ä—à—Ä—É—Ç—ñ–≤

### –ó–∞–≥–∞–ª—å–Ω–∏–π –ø–æ—Ç—ñ–∫ –ø–æ–±—É–¥–æ–≤–∏ –º–∞—Ä—à—Ä—É—Ç—É

```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –Ω–∞ –∫–∞—Ä—Ç—É
         ‚Üì
CreateRouteScreen._addRoutePoint()
         ‚Üì
CalculateRouteUseCase.call()
         ‚Üì
RoutingRepositoryImpl.calculateRoute()
         ‚Üì
RoadRoutingService.calculateRouteWithErrorHandling()
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–º–æ–≤:                    ‚îÇ
‚îÇ  1. –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∏–π?             ‚îÇ
‚îÇ  2. API –∫–ª—é—á –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ?           ‚îÇ
‚îÇ  3. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ–Ω–ª–∞–π–Ω API           ‚îÇ
‚îÇ  4. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ—Ñ–ª–∞–π–Ω –∫–∞—Ä—Ç–∏         ‚îÇ
‚îÇ  5. Fallback –Ω–∞ —Ä–æ–∑—É–º–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è RouteCalculationResult
         ‚Üì
–°—Ç–≤–æ—Ä–µ–Ω–Ω—è RouteSectionEntity
         ‚Üì
–î–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ _sections
         ‚Üì
–û–Ω–æ–≤–ª–µ–Ω–Ω—è UI (–≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞ –∫–∞—Ä—Ç—ñ)
```

### –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –ø—Ä–æ—Ü–µ—Å—É

#### 1. **CreateRouteScreen._addRoutePoint()**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/presentation/pages/create_route_screen.dart:162`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –û–±—Ä–æ–±–ª—è—î –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –∫–∞—Ä—Ç—É
- –í–∏–∫–ª–∏–∫–∞—î Use Case –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É
- –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É —Å–µ–∫—Ü—ñ—é –º–∞—Ä—à—Ä—É—Ç—É (`RouteSectionEntity`)
- –û–Ω–æ–≤–ª—é—î —Å—Ç–∞–Ω –≤—ñ–¥–∂–µ—Ç–∞

**–ö–æ–¥:**
```dart
void _addRoutePoint(LatLng point) async {
  if (_lastPoint != null) {
    // 1. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É —á–µ—Ä–µ–∑ Use Case
    final routeResult = await _calculateRouteUseCase(
      CalculateRouteParams(
        startPoint: _lastPoint!,
        endPoint: point,
        profile: _getRouteProfile(),
      ),
    );

    // 2. –û–±—Ä–æ–±–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
    routeResult.fold(
      (failure) => _showRouteErrorFromFailure(failure),
      (routeCoordinates) async {
        // 3. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
        final distance = await _calculateRouteDistanceUseCase(...);
        final elevationGain = await _calculateElevationGainUseCase(...);
        final windEffect = await _calculateWindEffectUseCase(...);

        // 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ–∫—Ü—ñ—ó –º–∞—Ä—à—Ä—É—Ç—É
        final newSection = RouteSectionEntity(
          id: DateTime.now().millisecondsSinceEpoch.toString(),
          coordinates: routeCoordinates,
          distance: distance,
          elevationGain: elevationGain,
          surfaceType: RoadSurfaceType.asphalt,
          windEffect: windEffect,
          difficulty: 0.0,
          averageSpeed: 15.0,
        );

        // 5. –î–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ —Å–ø–∏—Å–∫—É —Å–µ–∫—Ü—ñ–π
        setState(() {
          _sections.add(newSection);
        });
      },
    );
  }
  _lastPoint = point; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–æ—á–∫—É –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑'—î–¥–Ω–∞–Ω–Ω—è
}
```

**–í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `_lastPoint` –¥–ª—è –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—é —Ç–æ—á–∫–æ—é
- –°—Ç–≤–æ—Ä—é—î –æ–∫—Ä–µ–º—É —Å–µ–∫—Ü—ñ—é –¥–ª—è –∫–æ–∂–Ω–æ—ó –¥—ñ–ª—è–Ω–∫–∏ –º–∞—Ä—à—Ä—É—Ç—É
- –û–±—Ä–æ–±–ª—è—î –ø–æ–º–∏–ª–∫–∏ —á–µ—Ä–µ–∑ `fold()` –∑ Either —Ç–∏–ø—É

---

#### 2. **CalculateRouteUseCase**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/domain/usecases/calculate_route_usecase.dart`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –ê–±—Å—Ç—Ä–∞–∫—Ü—ñ—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É
- –í–∏–∫–ª–∏–∫–∞—î Repository –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- –ü–æ–≤–µ—Ä—Ç–∞—î `Either<Failure, List<LatLng>>`

**–ö–æ–¥:**
```dart
class CalculateRouteUseCase implements UseCase<List<LatLng>, CalculateRouteParams> {
  final RoutingRepository repository;

  @override
  Future<Either<Failure, List<LatLng>>> call(CalculateRouteParams params) async {
    return await repository.calculateRoute(
      startPoint: params.startPoint,
      endPoint: params.endPoint,
      profile: params.profile,
    );
  }
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –Ü–∑–æ–ª—è—Ü—ñ—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –≤—ñ–¥ UI
- –õ–µ–≥–∫–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–º—ñ–Ω–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

---

#### 3. **RoutingRepositoryImpl**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/data/repositories/routing_repository_impl.dart`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É Repository
- –í–∏–∫–ª–∏–∫–∞—î `RoadRoutingService` –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
- –ú–∞–ø–∏—Ç—å –ø–æ–º–∏–ª–∫–∏ –Ω–∞ `Failure` —Ç–∏–ø–∏

**–ö–æ–¥:**
```dart
@override
Future<Either<Failure, List<LatLng>>> calculateRoute({
  required LatLng startPoint,
  required LatLng endPoint,
  required String profile,
}) async {
  try {
    final result = await RoadRoutingService.calculateRouteWithErrorHandling(
      startPoint: startPoint,
      endPoint: endPoint,
      profile: profile,
    );

    if (result.isFailure) {
      return Left(Failure.routeCalculation(
        result.errorMessage,
        result.error!,
      ));
    }

    return Right(result.coordinates!);
  } catch (e) {
    return Left(ServerFailure('–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É: $e'));
  }
}
```

---

#### 4. **RoadRoutingService.calculateRouteWithErrorHandling()**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/core/services/road_routing_service.dart:75`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –ì–æ–ª–æ–≤–Ω–∏–π –º–µ—Ç–æ–¥ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É –∑ –¥–µ—Ç–∞–ª—å–Ω–æ—é –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫
- –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–º–æ–≤ —Ç–∞ —Å–ø—Ä–æ–± —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
- –ü–æ–≤–µ—Ä—Ç–∞—î `RouteCalculationResult` –∑ –¥–µ—Ç–∞–ª—å–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–±–æ—Ç–∏:**

```
1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
   ‚îú‚îÄ –ù–µ–º–∞—î ‚Üí RouteCalculationError.noInternet
   ‚îî‚îÄ –Ñ ‚Üí –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ

2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API –∫–ª—é—á–∞
   ‚îú‚îÄ –ù–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ ‚Üí RouteCalculationError.noApiKey + Crashlytics
   ‚îî‚îÄ –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ ‚Üí –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ

3. –°–ø—Ä–æ–±–∞ –æ–Ω–ª–∞–π–Ω API
   ‚îú‚îÄ –£—Å–ø—ñ—Ö ‚Üí –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
   ‚îî‚îÄ –ü–æ–º–∏–ª–∫–∞ ‚Üí –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ

4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω –∫–∞—Ä—Ç
   ‚îú‚îÄ –ù–µ–º–∞—î ‚Üí RouteCalculationError.noOfflineMaps
   ‚îî‚îÄ –Ñ ‚Üí –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ

5. –°–ø—Ä–æ–±–∞ –æ—Ñ–ª–∞–π–Ω –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
   ‚îú‚îÄ –£—Å–ø—ñ—Ö ‚Üí –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
   ‚îî‚îÄ –ü–æ–º–∏–ª–∫–∞ ‚Üí RouteCalculationError.offlineCalculationFailed + Crashlytics
```

**–ö–æ–¥:**
```dart
static Future<RouteCalculationResult> calculateRouteWithErrorHandling({
  required LatLng startPoint,
  required LatLng endPoint,
  String profile = 'cycling-regular',
}) async {
  // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
  final hasInternet = await _isInternetAvailable();
  if (!hasInternet) {
    return RouteCalculationResult.failure(
      RouteCalculationError.noInternet,
      '–ù–µ–º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑\'—î–¥–Ω–∞–Ω–Ω—è...',
    );
  }

  // 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API –∫–ª—é—á–∞
  final apiKey = _remoteConfig.openRouteServiceApiKey;
  if (apiKey == 'YOUR_OPENROUTESERVICE_API_KEY_HERE' || apiKey.isEmpty) {
    await CrashlyticsService().reportRouteCalculationError(...);
    return RouteCalculationResult.failure(
      RouteCalculationError.noApiKey,
      'API –∫–ª—é—á –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ...',
    );
  }

  // 3. –°–ø—Ä–æ–±–∞ –æ–Ω–ª–∞–π–Ω API
  final onlineRoute = await _calculateOnlineRoute(startPoint, endPoint, profile);
  if (onlineRoute.isNotEmpty) {
    return RouteCalculationResult.success(onlineRoute);
  }

  // 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω –∫–∞—Ä—Ç
  final hasOfflineMaps = await _hasOfflineMapsForArea(startPoint, endPoint);
  if (!hasOfflineMaps) {
    return RouteCalculationResult.failure(
      RouteCalculationError.noOfflineMaps,
      '–ù–µ–º–∞—î –æ—Ñ–ª–∞–π–Ω –∫–∞—Ä—Ç...',
    );
  }

  // 5. –°–ø—Ä–æ–±–∞ –æ—Ñ–ª–∞–π–Ω –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
  final offlineRoute = await _calculateRouteWithOfflineMaps(startPoint, endPoint, profile);
  if (offlineRoute.isNotEmpty) {
    return RouteCalculationResult.success(offlineRoute);
  }

  // 6. –í—Å–µ –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–æ
  await CrashlyticsService().reportRouteCalculationError(...);
  return RouteCalculationResult.failure(
    RouteCalculationError.offlineCalculationFailed,
    '–ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç...',
  );
}
```

---

#### 5. **RoadRoutingService._calculateOnlineRoute()**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/core/services/road_routing_service.dart:226`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –í–∏–∫–æ–Ω—É—î HTTP POST –∑–∞–ø–∏—Ç –¥–æ OpenRouteService API
- –ü–∞—Ä—Å–∏—Ç—å GeoJSON –≤—ñ–¥–ø–æ–≤—ñ–¥—å
- –î–µ–∫–æ–¥—É—î encoded polyline (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Ç—É:**
```json
{
  "coordinates": [
    [longitude1, latitude1],
    [longitude2, latitude2]
  ],
  "format": "geojson",
  "instructions": false,
  "options": {
    "avoid_features": ["ferries", "tunnels"]
  }
}
```

**–ö–æ–¥:**
```dart
static Future<List<LatLng>> _calculateOnlineRoute(
  LatLng startPoint, 
  LatLng endPoint, 
  String profile
) async {
  final url = '$baseUrl/directions/$profile';
  
  final body = {
    'coordinates': [
      [startPoint.longitude, startPoint.latitude],
      [endPoint.longitude, endPoint.latitude]
    ],
    'format': 'geojson',
    'instructions': false,
    'options': {
      'avoid_features': _getAvoidFeaturesForProfile(profile),
    }
  };

  final response = await http.post(
    Uri.parse(url),
    headers: {
      'Authorization': 'Bearer $apiKey',
      'Content-Type': 'application/json',
    },
    body: jsonEncode(body),
  );

  if (response.statusCode == 200) {
    final data = jsonDecode(response.body);
    return _extractCoordinatesFromGeoJSON(data);
  } else {
    await CrashlyticsService().reportRouteCalculationError(...);
    return [];
  }
}
```

---

#### 6. **RoadRoutingService._extractCoordinatesFromGeoJSON()**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/core/services/road_routing_service.dart:458`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –ü–∞—Ä—Å–∏—Ç—å GeoJSON –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ OpenRouteService
- –ü—ñ–¥—Ç—Ä–∏–º—É—î –¥–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∏:
  1. **Encoded polyline** (—Ä—è–¥–æ–∫)
  2. **Coordinates array** (–º–∞—Å–∏–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```
1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ 'routes'
   ‚îú‚îÄ –Ñ ‚Üí –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ geometry –≤ routes[0]
   ‚îî‚îÄ –ù–µ–º–∞—î ‚Üí –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ 'features'

2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏–ø—É geometry
   ‚îú‚îÄ String ‚Üí –î–µ–∫–æ–¥—É—î–º–æ polyline
   ‚îî‚îÄ Map ‚Üí –í–∏—Ç—è–≥—É—î–º–æ coordinates

3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
   ‚îî‚îÄ [longitude, latitude] ‚Üí LatLng(latitude, longitude)
```

**–ö–æ–¥:**
```dart
static List<LatLng> _extractCoordinatesFromGeoJSON(Map<String, dynamic> data) {
  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ routes (OpenRouteService —Ñ–æ—Ä–º–∞—Ç)
  if (data.containsKey('routes')) {
    final routes = data['routes'] as List;
    if (routes.isNotEmpty) {
      final route = routes.first;
      
      if (route.containsKey('geometry')) {
        final geometry = route['geometry'];
        
        // Encoded polyline string
        if (geometry is String) {
          return _decodePolyline(geometry);
        }
        
        // Coordinates array
        if (geometry is Map && geometry.containsKey('coordinates')) {
          final coordinates = geometry['coordinates'] as List;
          return coordinates.map((coord) => LatLng(coord[1], coord[0])).toList();
        }
      }
    }
  }
  
  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ features (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π GeoJSON)
  if (data.containsKey('features')) {
    // –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–∞ –ª–æ–≥—ñ–∫–∞...
  }
  
  return [];
}
```

---

#### 7. **–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É –Ω–∞ –∫–∞—Ä—Ç—ñ**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/presentation/pages/create_route_screen.dart:238`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –ì–µ–Ω–µ—Ä—É—î `Polyline` –æ–±'—î–∫—Ç–∏ –¥–ª—è –∫–æ–∂–Ω–æ—ó —Å–µ–∫—Ü—ñ—ó –º–∞—Ä—à—Ä—É—Ç—É
- –í–∏–∑–Ω–∞—á–∞—î –∫–æ–ª—ñ—Ä –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ (`getColorBasedOnDifficulty`)
- –ü—ñ–¥—Å–≤—ñ—á—É—î —Å–µ–∫—Ü—ñ—é, —è–∫—É –ø–µ—Ä–µ—Ç—è–≥—É—é—Ç—å

**–ö–æ–¥:**
```dart
List<Polyline> _generatePolylines() {
  final polylines = <Polyline>[];

  for (final entry in _sections.asMap().entries) {
    final index = entry.key;
    final section = entry.value;
    final color = getColorBasedOnDifficulty(section.difficulty);
    final isDragging = _isDragging && _draggedSegmentIndex == index;

    // –û—Å–Ω–æ–≤–Ω–∞ –ª—ñ–Ω—ñ—è
    polylines.add(Polyline(
      points: section.coordinates,
      color: isDragging ? Colors.orange : color,
      strokeWidth: isDragging ? 6 : 4,
    ));

    // –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è
    if (isDragging) {
      polylines.add(Polyline(
        points: section.coordinates,
        color: Colors.orange.withOpacity(0.3),
        strokeWidth: 8,
      ));
    }
  }

  return polylines;
}
```

---

## üñ±Ô∏è –ü–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤

### –ó–∞–≥–∞–ª—å–Ω–∏–π –ø–æ—Ç—ñ–∫ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è

```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–±–∏—Ç—å –¥–æ–≤–≥–µ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –º–∞—Ä—à—Ä—É—Ç
         ‚Üì
CreateRouteScreen._handleLongPressOnRoute()
         ‚Üì
–ü–æ—à—É–∫ –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞ (_findNearestSegment)
         ‚Üì
–ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Ä–µ–∂–∏–º—É –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è (_isDragging = true)
         ‚Üì
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –≤ –Ω–æ–≤–æ–º—É –º—ñ—Å—Ü—ñ
         ‚Üì
CreateRouteScreen._handleSegmentDrag()
         ‚Üì
CreateRouteScreen._moveRouteSection()
         ‚Üì
–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å–µ–∫—Ü—ñ—ó
         ‚Üì
–ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –≤—ñ–¥—Å—Ç–∞–Ω—ñ
         ‚Üì
–û–Ω–æ–≤–ª–µ–Ω–Ω—è UI
```

### –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –ø—Ä–æ—Ü–µ—Å—É

#### 1. **–ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Ä–µ–∂–∏–º—É –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/presentation/pages/create_route_screen.dart:748`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –û–±—Ä–æ–±–ª—è—î –¥–æ–≤–≥–µ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –º–∞—Ä—à—Ä—É—Ç
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö
- –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–∞–π–±–ª–∏–∂—á–∏–π –≤—ñ–¥—Ä—ñ–∑–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É
- –ê–∫—Ç–∏–≤—É—î —Ä–µ–∂–∏–º –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è

**–ö–æ–¥:**
```dart
void _handleLongPressOnRoute(LatLng point) {
  // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–º–æ–≤
  if (!RouteDragService.isDragEnabled || _sections.isEmpty) {
    return;
  }

  // 2. –ü–æ—à—É–∫ –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞
  final nearestSegmentIndex = _findNearestSegment(point);
  if (nearestSegmentIndex == -1) {
    return;
  }

  // 3. –ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Ä–µ–∂–∏–º—É
  setState(() {
    _isDragging = true;
    _draggedSegmentIndex = nearestSegmentIndex;
  });

  // 4. –ü—ñ–¥–∫–∞–∑–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
  ScaffoldMessenger.of(context).showSnackBar(
    const SnackBar(
      content: Text('–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –≤ –Ω–æ–≤–æ–º—É –º—ñ—Å—Ü—ñ –¥–ª—è –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç—É'),
    ),
  );
}
```

---

#### 2. **–ü–æ—à—É–∫ –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/presentation/pages/create_route_screen.dart:946`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –ü–µ—Ä–µ–±–∏—Ä–∞—î –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó –º–∞—Ä—à—Ä—É—Ç—É
- –î–ª—è –∫–æ–∂–Ω–æ—ó —Å–µ–∫—Ü—ñ—ó –ø–µ—Ä–µ–±–∏—Ä–∞—î –≤—Å—ñ –≤—ñ–¥—Ä—ñ–∑–∫–∏ (–ø–∞—Ä–∏ —Ç–æ—á–æ–∫)
- –†–æ–∑—Ä–∞—Ö–æ–≤—É—î –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ —Ç–æ—á–∫–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –¥–æ –∫–æ–∂–Ω–æ–≥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞
- –ü–æ–≤–µ—Ä—Ç–∞—î —ñ–Ω–¥–µ–∫—Å —Å–µ–∫—Ü—ñ—ó –∑ –Ω–∞–π–±–ª–∏–∂—á–∏–º –≤—ñ–¥—Ä—ñ–∑–∫–æ–º

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```
–î–ª—è –∫–æ–∂–Ω–æ—ó —Å–µ–∫—Ü—ñ—ó –≤ _sections:
  –î–ª—è –∫–æ–∂–Ω–æ—ó –ø–∞—Ä–∏ —Ç–æ—á–æ–∫ (i, i+1) –≤ —Å–µ–∫—Ü—ñ—ó:
    –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ —Ç–æ—á–∫–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –¥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞
    –Ø–∫—â–æ –≤—ñ–¥—Å—Ç–∞–Ω—å –º–µ–Ω—à–∞ –∑–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É:
      –ó–±–µ—Ä–µ–≥—Ç–∏ —ñ–Ω–¥–µ–∫—Å —Å–µ–∫—Ü—ñ—ó
      –û–Ω–æ–≤–∏—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –≤—ñ–¥—Å—Ç–∞–Ω—å

–ü–æ–≤–µ—Ä–Ω—É—Ç–∏ —ñ–Ω–¥–µ–∫—Å —Å–µ–∫—Ü—ñ—ó –∑ –Ω–∞–π–±–ª–∏–∂—á–∏–º –≤—ñ–¥—Ä—ñ–∑–∫–æ–º
```

**–ö–æ–¥:**
```dart
int _findNearestSegment(LatLng point) {
  double minDistance = double.infinity;
  int nearestIndex = -1;

  // –ü–µ—Ä–µ–±–∏—Ä–∞—î–º–æ –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó
  for (int i = 0; i < _sections.length; i++) {
    final section = _sections[i];

    // –ü–µ—Ä–µ–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –≤—ñ–¥—Ä—ñ–∑–∫–∏ –≤ —Å–µ–∫—Ü—ñ—ó
    for (int j = 0; j < section.coordinates.length - 1; j++) {
      final segmentStart = section.coordinates[j];
      final segmentEnd = section.coordinates[j + 1];

      // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ —Ç–æ—á–∫–∏ –¥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞
      final distance = _distanceToLineSegment(point, segmentStart, segmentEnd);

      if (distance < minDistance) {
        minDistance = distance;
        nearestIndex = i;
      }
    }
  }

  return nearestIndex;
}
```

---

#### 3. **–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤—ñ–¥—Å—Ç–∞–Ω—ñ –¥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/presentation/pages/create_route_screen.dart:1173`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –†–æ–∑—Ä–∞—Ö–æ–≤—É—î –Ω–∞–π–∫–æ—Ä–æ—Ç—à—É –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ —Ç–æ—á–∫–∏ –¥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤–µ–∫—Ç–æ—Ä–Ω—É –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –¥–ª—è –ø—Ä–æ–µ–∫—Ü—ñ—ó —Ç–æ—á–∫–∏ –Ω–∞ –≤—ñ–¥—Ä—ñ–∑–æ–∫

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```
1. –û–±—á–∏—Å–ª—é—î–º–æ –≤–µ–∫—Ç–æ—Ä–∏:
   A = point - lineStart
   B = lineEnd - lineStart

2. –û–±—á–∏—Å–ª—é—î–º–æ —Å–∫–∞–ª—è—Ä–Ω–∏–π –¥–æ–±—É—Ç–æ–∫:
   dot = A ¬∑ B
   lenSq = |B|¬≤

3. –û–±—á–∏—Å–ª—é—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–æ–µ–∫—Ü—ñ—ó:
   param = dot / lenSq

4. –í–∏–∑–Ω–∞—á–∞—î–º–æ –Ω–∞–π–±–ª–∏–∂—á—É —Ç–æ—á–∫—É –Ω–∞ –≤—ñ–¥—Ä—ñ–∑–∫—É:
   - –Ø–∫—â–æ param < 0 ‚Üí –Ω–∞–π–±–ª–∏–∂—á–∞ —Ç–æ—á–∫–∞ = lineStart
   - –Ø–∫—â–æ param > 1 ‚Üí –Ω–∞–π–±–ª–∏–∂—á–∞ —Ç–æ—á–∫–∞ = lineEnd
   - –Ü–Ω–∞–∫—à–µ ‚Üí –Ω–∞–π–±–ª–∏–∂—á–∞ —Ç–æ—á–∫–∞ = lineStart + param * B

5. –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –≤—ñ–¥—Å—Ç–∞–Ω—å:
   distance = |point - –Ω–∞–π–±–ª–∏–∂—á–∞ —Ç–æ—á–∫–∞|
```

**–ö–æ–¥:**
```dart
double _distanceToLineSegment(LatLng point, LatLng lineStart, LatLng lineEnd) {
  final A = point.latitude - lineStart.latitude;
  final B = point.longitude - lineStart.longitude;
  final C = lineEnd.latitude - lineStart.latitude;
  final D = lineEnd.longitude - lineStart.longitude;

  final dot = A * C + B * D;
  final lenSq = C * C + D * D;

  if (lenSq == 0) {
    return sqrt(A * A + B * B);
  }

  final param = dot / lenSq;

  double xx, yy;
  if (param < 0) {
    xx = lineStart.latitude;
    yy = lineStart.longitude;
  } else if (param > 1) {
    xx = lineEnd.latitude;
    yy = lineEnd.longitude;
  } else {
    xx = lineStart.latitude + param * C;
    yy = lineStart.longitude + param * D;
  }

  final dx = point.latitude - xx;
  final dy = point.longitude - yy;
  return sqrt(dx * dx + dy * dy);
}
```

---

#### 4. **–û–±—Ä–æ–±–∫–∞ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/presentation/pages/create_route_screen.dart:792`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –û–±—Ä–æ–±–ª—è—î –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –ø—ñ—Å–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Ä–µ–∂–∏–º—É –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è
- –í–∏–∫–ª–∏–∫–∞—î `_moveRouteSection` –¥–ª—è –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è —Å–µ–∫—Ü—ñ—ó
- –°–∫–∏–¥–∞—î —Ä–µ–∂–∏–º –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

**–ö–æ–¥:**
```dart
Future<void> _handleSegmentDrag(LatLng newPosition) async {
  if (!_isDragging || _draggedSegmentIndex == null) {
    return;
  }

  try {
    // –ü–µ—Ä–µ–º—ñ—â—É—î–º–æ —Å–µ–∫—Ü—ñ—é
    await _moveRouteSection(newPosition, _draggedSegmentIndex!);

    // –°–∫–∏–¥–∞—î–º–æ —Ä–µ–∂–∏–º
    setState(() {
      _isDragging = false;
      _draggedSegmentIndex = null;
    });

    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(content: Text('–¢–æ—á–∫–∞ –º–∞—Ä—à—Ä—É—Ç—É –ø–µ—Ä–µ–º—ñ—â–µ–Ω–∞')),
    );
  } catch (e) {
    LogService.log('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—ñ —Å–µ–∫—Ü—ñ—ó: $e');
  }
}
```

---

#### 5. **–ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è —Å–µ–∫—Ü—ñ—ó –º–∞—Ä—à—Ä—É—Ç—É**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/presentation/pages/create_route_screen.dart:845`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–∞–π–±–ª–∏–∂—á—É —Ç–æ—á–∫—É –≤ —Å–µ–∫—Ü—ñ—ó –¥–æ –Ω–æ–≤–æ—ó –ø–æ–∑–∏—Ü—ñ—ó
- –û–Ω–æ–≤–ª—é—î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ü—ñ—î—ó —Ç–æ—á–∫–∏
- –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î –≤—ñ–¥—Å—Ç–∞–Ω—å —Å–µ–∫—Ü—ñ—ó
- **–ù–ï –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ API** (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∑–∞–π–≤–∏—Ö –≥—ñ–ª–æ–∫)

**–í–∞–∂–ª–∏–≤–∏–π –º–æ–º–µ–Ω—Ç:**
–¶–µ–π –º–µ—Ç–æ–¥ **–ù–ï** –≤–∏–∫–ª–∏–∫–∞—î API –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É. –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤—ñ–Ω –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–ª—é—î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–∞–π–±–ª–∏–∂—á–æ—ó —Ç–æ—á–∫–∏ –≤ —Å–µ–∫—Ü—ñ—ó. –¶–µ –∑–∞–ø–æ–±—ñ–≥–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—é –∑–∞–π–≤–∏—Ö –≥—ñ–ª–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É.

**–ö–æ–¥:**
```dart
Future<void> _moveRouteSection(LatLng newPosition, int segmentIndex) async {
  if (segmentIndex < 0 || segmentIndex >= _sections.length) {
    return;
  }

  final section = _sections[segmentIndex];

  // 1. –ó–Ω–∞—Ö–æ–¥–∏–º–æ –Ω–∞–π–±–ª–∏–∂—á—É —Ç–æ—á–∫—É –≤ —Å–µ–∫—Ü—ñ—ó
  int closestPointIndex = _findClosestPointInSection(
    section.coordinates, 
    newPosition
  );

  // 2. –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∑ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ—é —Ç–æ—á–∫–æ—é
  final newCoordinates = List<LatLng>.from(section.coordinates);
  newCoordinates[closestPointIndex] = newPosition;

  // 3. –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ–∫—Ü—ñ—é (–ë–ï–ó –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É —á–µ—Ä–µ–∑ API)
  final updatedSection = section.copyWith(
    coordinates: newCoordinates,
    distance: _calculateDistance(newCoordinates),
  );

  // 4. –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —Å–µ–∫—Ü—ñ–π
  setState(() {
    _sections[segmentIndex] = updatedSection;
  });
}
```

---

#### 6. **–ü–æ—à—É–∫ –Ω–∞–π–±–ª–∏–∂—á–æ—ó —Ç–æ—á–∫–∏ –≤ —Å–µ–∫—Ü—ñ—ó**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/presentation/pages/create_route_screen.dart:881`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å:**
- –ü–µ—Ä–µ–±–∏—Ä–∞—î –≤—Å—ñ —Ç–æ—á–∫–∏ –≤ —Å–µ–∫—Ü—ñ—ó
- –†–æ–∑—Ä–∞—Ö–æ–≤—É—î –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ –∫–æ–∂–Ω–æ—ó —Ç–æ—á–∫–∏ –¥–æ —Ü—ñ–ª—å–æ–≤–æ—ó –ø–æ–∑–∏—Ü—ñ—ó
- –ü–æ–≤–µ—Ä—Ç–∞—î —ñ–Ω–¥–µ–∫—Å –Ω–∞–π–±–ª–∏–∂—á–æ—ó —Ç–æ—á–∫–∏

**–ö–æ–¥:**
```dart
int _findClosestPointInSection(List<LatLng> coordinates, LatLng targetPoint) {
  double minDistance = double.infinity;
  int closestIndex = 0;

  for (int i = 0; i < coordinates.length; i++) {
    final distance = _calculateDistanceBetweenPoints(
      coordinates[i], 
      targetPoint
    );
    
    if (distance < minDistance) {
      minDistance = distance;
      closestIndex = i;
    }
  }

  return closestIndex;
}
```

---

#### 7. **RouteDragService (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –ø–æ—Ç–æ—á–Ω—ñ–π —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó)**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/core/services/route_drag_service.dart`

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –¶–µ–π —Å–µ—Ä–≤—ñ—Å —ñ—Å–Ω—É—î –≤ –∫–æ–¥—ñ, –∞–ª–µ **–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è** –≤ –ø–æ—Ç–æ—á–Ω—ñ–π —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è. –í—ñ–Ω –º—ñ—Å—Ç–∏—Ç—å –±—ñ–ª—å—à —Å–∫–ª–∞–¥–Ω—É –ª–æ–≥—ñ–∫—É –∑:
- –ü—Ä–∏–ª–∏–ø–∞–Ω–Ω—è–º –¥–æ –Ω–∞–π–±–ª–∏–∂—á–æ—ó –¥–æ—Ä–æ–≥–∏ (`_snapToNearestRoad`)
- –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫–æ–º –º–∞—Ä—à—Ä—É—Ç—É —á–µ—Ä–µ–∑ API (`_recalculateRouteWithNewPoint`)

**–ß–æ–º—É –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è:**
–ü–æ—Ç–æ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–æ—Å—Ç—ñ—à–∏–π –ø—ñ–¥—Ö—ñ–¥ - –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–ª—é—î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–æ—á–∫–∏ –±–µ–∑ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É —á–µ—Ä–µ–∑ API, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–π–≤–∏—Ö –≥—ñ–ª–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É.

---

## üîß –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

#### **RouteSectionEntity**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/features/map/domain/entities/route_entity.dart:28`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```dart
@freezed
class RouteSectionEntity with _$RouteSectionEntity {
  const factory RouteSectionEntity({
    required String id,                    // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
    required List<LatLng> coordinates,      // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–µ–∫—Ü—ñ—ó
    required double distance,               // –í—ñ–¥—Å—Ç–∞–Ω—å –≤ –º–µ—Ç—Ä–∞—Ö
    required double elevationGain,          // –ù–∞–±—ñ—Ä –≤–∏—Å–æ—Ç–∏ –≤ –º–µ—Ç—Ä–∞—Ö
    required RoadSurfaceType surfaceType,   // –¢–∏–ø –ø–æ–∫—Ä–∏—Ç—Ç—è
    required double windEffect,             // –í–ø–ª–∏–≤ –≤—ñ—Ç—Ä—É
    required double difficulty,             // –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å (0-10)
    required double averageSpeed,           // –°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å –∫–º/–≥–æ–¥
    String? notes,                          // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏
  }) = _RouteSectionEntity;
}
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- Immutable (Freezed)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `copyWith` –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ `_sections: List<RouteSectionEntity>`

---

#### **RouteCalculationResult**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/core/services/road_routing_service.dart:20`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```dart
class RouteCalculationResult {
  final List<LatLng>? coordinates;
  final RouteCalculationError? error;
  final String? errorMessage;

  RouteCalculationResult.success(this.coordinates)
      : error = null, errorMessage = null;
  
  RouteCalculationResult.failure(this.error, this.errorMessage)
      : coordinates = null;

  bool get isSuccess => coordinates != null;
  bool get isFailure => error != null;
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
- –û–±–≥–æ—Ä—Ç–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É
- –ú—ñ—Å—Ç–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ `RoadRoutingService`

---

### –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

#### **RouteCalculationError**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/core/services/road_routing_service.dart:10`

**–¢–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫:**
```dart
enum RouteCalculationError {
  noInternet,              // –ù–µ–º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
  noApiKey,                // –ù–µ–º–∞—î API –∫–ª—é—á–∞
  apiError,                // –ü–æ–º–∏–ª–∫–∞ API
  noOfflineMaps,           // –ù–µ–º–∞—î –æ—Ñ–ª–∞–π–Ω –∫–∞—Ä—Ç
  offlineCalculationFailed, // –ü–æ–º–∏–ª–∫–∞ –æ—Ñ–ª–∞–π–Ω —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
  unknown,                 // –ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞
}
```

**–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó:**
- **userActionable**: `noInternet`, `noOfflineMaps`
- **developerIssue**: `noApiKey`
- **systemError**: `apiError`, `offlineCalculationFailed`, `unknown`

---

#### **Failure**

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/core/error/failures.dart:6`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```dart
@freezed
class Failure with _$Failure {
  const factory Failure.server([String? message]) = ServerFailure;
  const factory Failure.cache([String? message]) = CacheFailure;
  const factory Failure.network([String? message]) = NetworkFailure;
  const factory Failure.auth([String? message]) = AuthFailure;
  const factory Failure.validation([String? message]) = ValidationFailure;
  const factory Failure.permission([String? message]) = PermissionFailure;
  const factory Failure.routeCalculation([
    String? message,
    RouteCalculationError? errorType,
  ]) = RouteCalculationFailure;
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ Use Cases —á–µ—Ä–µ–∑ `Either<Failure, T>`
- –ú–∞–ø–∏—Ç—å—Å—è –∑ `RouteCalculationError` –≤ Repository

---

### –ü—Ä–æ—Ñ—ñ–ª—ñ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó

**–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** `lib/core/services/road_routing_service.dart:615`

**–î–æ—Å—Ç—É–ø–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ:**
- `cycling-regular` - –≤–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ñ –¥–æ—Ä–æ–≥–∏ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
- `driving-car` - –∞–≤—Ç–æ–º–æ–±—ñ–ª—å–Ω—ñ –¥–æ—Ä–æ–≥–∏
- `foot-walking` - –ø—ñ—à–æ—Ö—ñ–¥–Ω—ñ —Å—Ç–µ–∂–∫–∏

**–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é:**
```dart
String _getRouteProfile() {
  final settingsState = context.read<SettingsCubit>().state;
  return settingsState.maybeWhen(
    loaded: (settings) => settings.routeProfile ?? 'cycling-regular',
    orElse: () => 'cycling-regular',
  );
}
```

---

## üìä –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–∏—Ö

### –ü–æ—Ç—ñ–∫ –ø–æ–±—É–¥–æ–≤–∏ –º–∞—Ä—à—Ä—É—Ç—É

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á     ‚îÇ
‚îÇ  –Ω–∞—Ç–∏—Å–∫–∞—î       ‚îÇ
‚îÇ  –Ω–∞ –∫–∞—Ä—Ç—É       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CreateRouteScreen        ‚îÇ
‚îÇ _addRoutePoint()         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CalculateRouteUseCase    ‚îÇ
‚îÇ call()                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RoutingRepositoryImpl    ‚îÇ
‚îÇ calculateRoute()        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RoadRoutingService       ‚îÇ
‚îÇ calculateRouteWith...() ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚ñ∫ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
         ‚îú‚îÄ‚ñ∫ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API –∫–ª—é—á–∞
         ‚îú‚îÄ‚ñ∫ –°–ø—Ä–æ–±–∞ –æ–Ω–ª–∞–π–Ω API
         ‚îú‚îÄ‚ñ∫ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω –∫–∞—Ä—Ç
         ‚îî‚îÄ‚ñ∫ –°–ø—Ä–æ–±–∞ –æ—Ñ–ª–∞–π–Ω –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RouteCalculationResult   ‚îÇ
‚îÇ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∞–±–æ –ø–æ–º–∏–ª–∫–∞) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚ñ∫ Success ‚Üí –°—Ç–≤–æ—Ä–µ–Ω–Ω—è RouteSectionEntity
         ‚îî‚îÄ‚ñ∫ Failure ‚Üí –ü–æ–∫–∞–∑ –¥—ñ–∞–ª–æ–≥—É –ø–æ–º–∏–ª–∫–∏
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI             ‚îÇ
‚îÇ (_sections.add())        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### –ü–æ—Ç—ñ–∫ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á     ‚îÇ
‚îÇ  –¥–æ–≤–≥–µ          ‚îÇ
‚îÇ  –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CreateRouteScreen        ‚îÇ
‚îÇ _handleLongPressOnRoute()‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚ñ∫ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ RouteDragService.isDragEnabled
         ‚îú‚îÄ‚ñ∫ –ü–æ—à—É–∫ –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ –≤—ñ–¥—Ä—ñ–∑–∫–∞
         ‚îî‚îÄ‚ñ∫ –ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Ä–µ–∂–∏–º—É (_isDragging = true)
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á     ‚îÇ
‚îÇ  –Ω–∞—Ç–∏—Å–∫–∞—î       ‚îÇ
‚îÇ  –≤ –Ω–æ–≤–æ–º—É –º—ñ—Å—Ü—ñ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CreateRouteScreen        ‚îÇ
‚îÇ _handleSegmentDrag()     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CreateRouteScreen        ‚îÇ
‚îÇ _moveRouteSection()      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚ñ∫ –ü–æ—à—É–∫ –Ω–∞–π–±–ª–∏–∂—á–æ—ó —Ç–æ—á–∫–∏ –≤ —Å–µ–∫—Ü—ñ—ó
         ‚îú‚îÄ‚ñ∫ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
         ‚îî‚îÄ‚ñ∫ –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –≤—ñ–¥—Å—Ç–∞–Ω—ñ
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI             ‚îÇ
‚îÇ (_sections[index] = ...) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ –ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### 1. **–°–µ–∫—Ü—ñ–π–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞—Ä—à—Ä—É—Ç—É**

–ú–∞—Ä—à—Ä—É—Ç —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ **—Å–µ–∫—Ü—ñ–π** (`RouteSectionEntity`), –¥–µ –∫–æ–∂–Ω–∞ —Å–µ–∫—Ü—ñ—è:
- –ú–∞—î —Å–≤–æ—ó –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
- –ú–∞—î —Å–≤–æ—é –≤—ñ–¥—Å—Ç–∞–Ω—å, –Ω–∞–±—ñ—Ä –≤–∏—Å–æ—Ç–∏, —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å
- –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ—é –ø–æ–ª—ñ–ª—ñ–Ω—ñ—î—é –Ω–∞ –∫–∞—Ä—Ç—ñ

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º—ñ —Å–µ–∫—Ü—ñ—ó
- –†—ñ–∑–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –¥—ñ–ª—è–Ω–æ–∫
- –õ–µ–≥—à–µ –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–∞—Ä—à—Ä—É—Ç—É

---

### 2. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –ø—Ä–∏ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—ñ**

–ü—Ä–∏ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—ñ —Å–µ–∫—Ü—ñ—ó **–ù–ï** –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è API –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É. –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ:
- –û–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–∞–π–±–ª–∏–∂—á–æ—ó —Ç–æ—á–∫–∏
- –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –≤—ñ–¥—Å—Ç–∞–Ω—å –ª–æ–∫–∞–ª—å–Ω–æ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞—Ä—à—Ä—É—Ç—É –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è

**–ß–æ–º—É:**
- –£–Ω–∏–∫–∞—î–º–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–π–≤–∏—Ö –≥—ñ–ª–æ–∫
- –®–≤–∏–¥—à–µ –≤—ñ–¥–≥—É–∫ UI
- –ú–µ–Ω—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ API

---

### 3. **–î–µ—Ç–∞–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫**

–°–∏—Å—Ç–µ–º–∞ –º–∞—î —Ç—Ä–∏—Ä—ñ–≤–Ω–µ–≤—É –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫:
1. **RouteCalculationError** - –¥–µ—Ç–∞–ª—å–Ω—ñ —Ç–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫
2. **RouteCalculationResult** - –æ–±–≥–æ—Ä—Ç–∫–∞ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏
3. **Failure** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –¥–ª—è Use Cases

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ Crashlytics
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ–∑–∞—Ü—ñ—è –ø–æ–º–∏–ª–æ–∫

---

### 4. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∏**

–ö–∞—Ä—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–¥–∞–ø—Ç—É—î—Ç—å—Å—è:
- –ü—ñ–¥ —Ä–æ–∑–º—ñ—Ä –µ–∫—Ä–∞–Ω—É
- –ü—ñ–¥ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ—á–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É
- –ü—ñ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/–ø–µ—Ä–µ–≥–ª—è–¥)

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**
```dart
MapOptions _createAdaptiveMapOptions() {
  final adaptiveOptions = AdaptiveMapOptions(
    context: MapContext.routeCreation,
    routePoints: _sections.expand((s) => s.coordinates).toList(),
    screenSize: MediaQuery.of(context).size,
    enableAutoFit: routePoints != null && routePoints.length > 1,
  );
  return adaptiveOptions.toMapOptions();
}
```

---

## üìù –í–∏—Å–Ω–æ–≤–∫–∏

### –°–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏

1. **Clean Architecture** - —á—ñ—Ç–∫–µ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π
2. **–î–µ—Ç–∞–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫** - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–≤–∂–¥–∏ –∑–Ω–∞—î —â–æ —Å—Ç–∞–ª–æ—Å—è
3. **–°–µ–∫—Ü—ñ–π–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - –≥–Ω—É—á–∫—ñ—Å—Ç—å —É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ –º–∞—Ä—à—Ä—É—Ç—É
4. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è** - —à–≤–∏–¥–∫–∏–π –≤—ñ–¥–≥—É–∫ –±–µ–∑ –∑–∞–π–≤–∏—Ö API –≤–∏–∫–ª–∏–∫—ñ–≤

### –ú–æ–∂–ª–∏–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

1. **RouteDragService** - –∑–∞—Ä–∞–∑ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è, –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ –∞–±–æ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏
2. **–û—Ñ–ª–∞–π–Ω –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è** - –∑–∞—Ä–∞–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–æ—Å—Ç–∏–π fallback
3. **–ö–µ—à—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤** - –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –¥–ª—è —à–≤–∏–¥—à–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
4. **–í—ñ–∑—É–∞–ª—å–Ω–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è** - –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –ø—ñ–¥—Å–≤—ñ—Ç–∫—É –ø—Ä–∏ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—ñ

---

## üîó –ü–æ–≤'—è–∑–∞–Ω—ñ —Ñ–∞–π–ª–∏

### Presentation Layer
- `lib/features/map/presentation/pages/create_route_screen.dart` - –≥–æ–ª–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω
- `lib/features/map/presentation/pages/route_screen.dart` - –µ–∫—Ä–∞–Ω –ø–µ—Ä–µ–≥–ª—è–¥—É –º–∞—Ä—à—Ä—É—Ç—É

### Domain Layer
- `lib/features/map/domain/usecases/calculate_route_usecase.dart`
- `lib/features/map/domain/usecases/calculate_route_distance_usecase.dart`
- `lib/features/map/domain/entities/route_entity.dart`

### Data Layer
- `lib/features/map/data/repositories/routing_repository_impl.dart`
- `lib/core/services/road_routing_service.dart`
- `lib/core/services/route_drag_service.dart`

### Error Handling
- `lib/core/error/failures.dart`
- `lib/core/services/crashlytics_service.dart`

